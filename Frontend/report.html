<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ECO TRACK Reports Management</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
    tailwind.config = {
        theme: {
            extend: {
                colors: {
                    'accent-blue': '#3498db',
                    'accent-dark': '#2E4457',
                    'green-primary': '#2ecc71',
                    'green-secondary': '#27ae60',
                    'gray-primary': '#6c757d',
                    'gray-light': '#f8f9fa',
                },
                animation: {
                    'gradient-bg': 'gradientBG 15s ease infinite',
                    'bounce-slow': 'bounce 2s infinite',
                    'fade-in': 'fadeIn 0.5s ease-in',
                    'slide-up': 'slideUp 0.3s ease-out',
                }
            }
        }
    }
</script>
<style> 
  :root {
    --accent-blue: #3498db;
    --accent-dark: #2E4457;
    --green-primary: #2ecc71;
    --green-secondary: #27ae60;
    --gray-primary: #6c757d;
    --gray-light: #f8f9fa;
  }

  body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(-45deg, #f0f8ff, #e6f3ff, #ecf8fc, #e2f4f8);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    display: flex; flex-direction: column;
  }

  /* Sidebar Styling - Made thinner */
  .sidebar {
    width: 60px;
    background: linear-gradient(180deg, rgb(25, 25, 25) 0%, rgb(35, 35, 35) 100%);
    color: #ffffff;
    padding: 12px 6px;
    position: fixed;
    height: 100vh;
    overflow-y: auto;
    transition: all 0.28s cubic-bezier(.2,.8,.2,1);
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 1000;
    box-shadow: 4px 0 20px rgba(0,0,0,0.1);
  }

  .sidebar:hover,
  .sidebar:focus-within {
    width: 250px;
    padding: 20px;
    align-items: flex-start;
  }

  .sidebar-header {
    width: 100%;
    padding: 6px 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    margin-bottom: 16px;
    display: flex;
    justify-content: center;
  }

  .sidebar:hover .sidebar-header,
  .sidebar:focus-within .sidebar-header {
    justify-content: flex-start;
  }

  .sidebar-header img {
    width: 40px;
    height: auto;
    transition: width 0.28s;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
  }

  .sidebar:hover .sidebar-header img,
  .sidebar:focus-within .sidebar-header img {
    width: 180px;
  }

  /* Navigation Menu */
  .nav-menu {
    list-style: none;
    padding: 0;
    width: 100%;
  }

  .nav-item {
    margin: 6px 0;
    width: 100%;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 10px 8px;
    color: #ffffff;
    text-decoration: none;
    transition: all 0.3s cubic-bezier(.2,.8,.2,1);
    border-left: 3px solid transparent;
    font-size: 16px;
    width: 100%;
    box-sizing: border-box;
    border-radius: 8px;
    position: relative;
    overflow: hidden;
  }

  .nav-icon {
    width: 26px;
    height: 26px;
    flex: 0 0 26px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: #ffffff;
    z-index: 1;
  }

  .nav-icon svg {
    fill: #ffffff;
    width: 22px;
    height: 22px;
  }

  .nav-label {
    white-space: nowrap;
    overflow: hidden;
    opacity: 0;
    max-width: 0;
    transition: all 0.28s ease;
    color: #ffffff;
    font-weight: 500;
    z-index: 1;
  }

  .sidebar:hover .nav-label,
  .sidebar:focus-within .nav-label {
    opacity: 1;
    max-width: 400px;
  }

  .nav-link:hover {
    background: rgba(255, 255, 255, 0.1);
    border-left-color: #f4d03f;
    transform: translateX(4px);
  }

  .nav-link:hover .nav-icon svg {
    fill: #f4d03f;
  }

  /* Updated active state to use blue instead of yellow */
  .nav-link.active {
    background: linear-gradient(45deg, rgba(52, 152, 219, 0.2), rgba(52, 152, 219, 0.1));
    border-left-color: var(--accent-blue);
    color: var(--accent-blue);
  }

  .nav-link.active .nav-icon svg {
    fill: var(--accent-blue);
  }

  /* Header */
  .top-header {
    position: fixed;
    top: 0;
    right: 0;
    width: calc(100% - 60px);
    height: 70px;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 30px;
    gap: 20px;
    z-index: 999;
    transition: width 0.28s;
    box-shadow: 0 2px 20px rgba(0,0,0,0.1);
  }

  .top-right-controls {
    display: flex;
    align-items: center;
    gap: 16px;
  }

  .top-left {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .top-logo {
    height: 36px;
    width: auto;
    object-fit: contain;
    filter: drop-shadow(0 2px 4px rgba(0,0,0,0.08));
  }

  /* Profile Section Styling */
  .profile-section {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 16px;
    background: rgba(52, 152, 219, 0.1);
    border-radius: 25px;
    border: 1px solid rgba(52, 152, 219, 0.2);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .profile-section:hover {
    background: rgba(52, 152, 219, 0.15);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.2);
  }

  .profile-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(45deg, var(--accent-blue), var(--accent-dark));
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
    border: 2px solid white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .profile-info {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .profile-name {
    font-weight: 600;
    font-size: 14px;
    color: var(--accent-blue);
  }

  .profile-role {
    font-size: 12px;
    color: var(--gray-primary);
  }

  @keyframes gradientBG {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes slideUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .sidebar {
        width: 100%;
        height: 70px;
        position: fixed;
        bottom: 0;
        top: auto;
        padding: 8px 16px;
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
        z-index: 1002;
        background: rgba(25, 25, 25, 0.95);
        backdrop-filter: blur(15px);
    }

    .nav-menu {
        display: flex;
        flex-direction: row;
        width: 100%;
        justify-content: space-around;
    }

    .nav-label {
        font-size: 10px;
    }

    .nav-icon {
        width: 24px;
        height: 24px;
    }

    .sidebar-header {
        display: none;
    }

    .top-header {
        width: 100%;
    }

    .profile-info {
        display: none;
    }
  }
</style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-cyan-50 to-sky-50">

<!-- Sidebar -->
<nav class="sidebar" aria-label="Main navigation">
    <div class="sidebar-header">
        <img src="../images/logoo.png" alt="ECO TRACK company logo">
    </div>
    <ul class="nav-menu">
        <li class="nav-item">
            <a href="dashboard.html" class="nav-link" role="button">
                <span class="nav-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                    </svg>
                </span>
                <span class="nav-label">Home</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="analysis.html" class="nav-link" role="button">
                <span class="nav-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                    </svg>
                </span>
                <span class="nav-label">Analytics</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="report.html" class="nav-link active" role="button">
                <span class="nav-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                    </svg>
                </span>
                <span class="nav-label">Reports</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="chatbot.html" class="nav-link" role="button">
                <span class="nav-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M21,16.5C21,16.88 20.79,17.21 20.47,17.38L12.57,21.82C12.41,21.94 12.21,22 12,22C11.79,22 11.59,21.94 11.43,21.82L3.53,17.38C3.21,17.21 3,16.88 3,16.5V7.5C3,7.12 3.21,6.79 3.53,6.62L11.43,2.18C11.59,2.06 11.79,2 12,2C12.21,2 12.41,2.06 12.57,2.18L20.47,6.62C20.79,6.79 21,7.12 21,7.5V16.5M12,4.15L6.04,7.5L12,10.85L17.96,7.5L12,4.15Z"/>
                    </svg>
                </span>
                <span class="nav-label">Eco AI</span>
            </a>
        </li>
        <li class="nav-item">
            <a href="settings.html" class="nav-link" role="button">
                <span class="nav-icon" aria-hidden="true">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3,17V19H9V17H3M3,5V7H13V5H3M13,21V19H21V17H13V15H11V21H13M7,9V11H3V13H7V15H9V9H7M21,13V11H11V13H21M15,9H17V7H21V5H17V3H15V9Z"/>
                    </svg>
                </span>
                <span class="nav-label">Settings</span>
            </a>
        </li>
    </ul>
</nav>

<!-- Top Header -->
<div class="top-header">
    <div class="top-left">
        <img src="../images/outer.png" alt="outer" class="top-logo">
    </div>
    
    <div class="top-right-controls">
        <div class="profile-section">
            <div class="profile-avatar">RA</div>
            <div class="profile-info">
                <div class="profile-name">Ravi Admin</div>
                <div class="profile-role">Administrator</div>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="ml-16 mt-20 flex flex-1 gap-6 p-6 h-screen overflow-hidden transition-all duration-300">
    
    <!-- Upload Area (Left) -->
    <div class="flex-1 bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl shadow-blue-500/10 p-8 flex flex-col border border-blue-100">
        
        <!-- Upload Header -->
        <div class="text-center mb-8">
            <div class="w-20 h-20 bg-gradient-to-br from-blue-400 to-cyan-500 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg">
                <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM6.293 6.707a1 1 0 010-1.414l3-3a1 1 0 011.414 0l3 3a1 1 0 01-1.414 1.414L11 5.414V13a1 1 0 11-2 0V5.414L7.707 6.707a1 1 0 01-1.414 0z"/>
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Upload Documents</h2>
            <p class="text-gray-600">Drag & drop files or browse to upload</p>
        </div>

        <!-- Drag & Drop Zone -->
        <div class="flex-1 flex flex-col">
            <div id="dragDropZone" class="flex-1 border-3 border-dashed border-blue-300 rounded-2xl flex flex-col items-center justify-center cursor-pointer transition-all duration-300 hover:border-blue-400 hover:bg-blue-50/50 group">
                <div class="text-center p-8">
                    <svg class="w-16 h-16 text-blue-400 mx-auto mb-4 group-hover:scale-110 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                    <p class="text-lg font-semibold text-gray-700 mb-2">Drop files here to upload</p>
                    <p class="text-sm text-gray-500 mb-4">Supports PDF, DOC, XLSX, TXT, Images</p>
                </div>
            </div>

            <!-- Security Options -->
            <div class="mt-6 p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl border border-amber-200">
                <div class="flex items-center gap-3 mb-3">
                    <svg class="w-5 h-5 text-amber-600" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
                    </svg>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" id="sensitiveData" class="rounded border-amber-300 text-amber-600 focus:ring-amber-500">
                        <span class="font-semibold text-amber-800">Mark as Sensitive Data</span>
                    </label>
                </div>
                <div id="passwordSection" class="hidden space-y-3">
                    <input type="password" id="filePassword" placeholder="Set password for sensitive files..." class="w-full px-3 py-2 border border-amber-300 rounded-lg focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-colors">
                    <p class="text-xs text-amber-700">Files marked as sensitive will require this password to view or download</p>
                </div>
            </div>

            <!-- Upload Button -->
            <button id="browseBtn" class="mt-6 bg-gradient-to-r from-blue-500 to-cyan-500 text-white font-bold py-4 px-8 rounded-2xl hover:from-blue-600 hover:to-cyan-600 transition-all duration-300 transform hover:scale-105 hover:shadow-xl flex items-center justify-center gap-3">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M8 2a1 1 0 000 2h2a1 1 0 100-2H8z"/>
                    <path d="M3 5a2 2 0 012-2h1a3 3 0 003 3h2a3 3 0 003-3h1a2 2 0 012 2v6h-4.586l1.293-1.293a1 1 0 00-1.414-1.414l-3 3a1 1 0 000 1.414l3 3a1 1 0 001.414-1.414L12.586 13H17v3a2 2 0 01-2 2H5a2 2 0 01-2-2V5z"/>
                </svg>
                Browse Files
            </button>
            <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.xlsx,.xls,.txt,.png,.jpg,.jpeg" class="hidden">
        </div>
    </div>

    <!-- Reports Area (Right) -->
    <div class="flex-[1.5] bg-white/95 backdrop-blur-sm rounded-2xl shadow-xl shadow-blue-500/10 p-8 overflow-hidden border border-blue-100">
        
        <!-- Reports Header -->
        <div class="flex items-center justify-between mb-6">
            <div>
                <h2 class="text-2xl font-bold text-gray-800 mb-1">Document Library</h2>
                <p class="text-gray-600">Manage your uploaded documents</p>
            </div>
            <div class="flex items-center gap-4">
                <!-- Search -->
                <div class="relative">
                    <input type="text" id="searchFiles" placeholder="Search documents..." class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors">
                    <svg class="w-5 h-5 text-gray-400 absolute left-3 top-2.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                    </svg>
                </div>
                <!-- Filter -->
                <select id="filterFiles" class="px-4 py-2 border border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-colors">
                    <option value="all">All Files</option>
                    <option value="sensitive">Sensitive</option>
                    <option value="public">Public</option>
                    <option value="recent">Recent</option>
                </select>
            </div>
        </div>

        <!-- File Statistics -->
        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="bg-gradient-to-br from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-blue-600">Total Files</p>
                        <p class="text-2xl font-bold text-blue-800" id="totalFiles">0</p>
                    </div>
                    <svg class="w-8 h-8 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4z"/>
                    </svg>
                </div>
            </div>
            <div class="bg-gradient-to-br from-amber-50 to-orange-50 p-4 rounded-xl border border-amber-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-amber-600">Sensitive</p>
                        <p class="text-2xl font-bold text-amber-800" id="sensitiveFiles">0</p>
                    </div>
                    <svg class="w-8 h-8 text-amber-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
                    </svg>
                </div>
            </div>
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-green-600">Storage Used</p>
                        <p class="text-2xl font-bold text-green-800" id="storageUsed">0 MB</p>
                    </div>
                    <svg class="w-8 h-8 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Reports List -->
        <div class="flex-1 overflow-y-auto">
            <div id="reportsList" class="space-y-3"></div>
            <div id="emptyState" class="text-center py-12">
                <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <p class="text-xl font-semibold text-gray-600 mb-2">No documents yet</p>
                <p class="text-gray-500">Upload your first document to get started</p>
            </div>
        </div>
    </div>
</div>

<!-- Password Modal -->
<div id="passwordModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm hidden items-center justify-center z-50 transition-all duration-300">
    <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md mx-4 transform transition-all duration-300">
        <div class="text-center mb-6">
            <div class="w-16 h-16 bg-gradient-to-br from-amber-400 to-orange-500 rounded-full mx-auto mb-4 flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Protected Document</h3>
            <p class="text-gray-600">Enter password to access this sensitive document</p>
        </div>
        <div class="space-y-4">
            <input type="password" id="passwordInput" placeholder="Enter password..." class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-colors">
            <div class="flex gap-3">
                <button id="cancelPassword" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors">Cancel</button>
                <button id="submitPassword" class="flex-1 px-4 py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl hover:from-amber-600 hover:to-orange-600 transition-colors">Unlock</button>
            </div>
        </div>
    </div>
</div>

<!-- Preview Modal -->
<div id="previewModal" class="fixed inset-0 bg-black/75 backdrop-blur-sm hidden items-center justify-center z-50 transition-all duration-300">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] mx-4 overflow-hidden">
        <div class="flex items-center justify-between p-6 border-b border-gray-200">
            <h3 id="modalTitle" class="text-xl font-bold text-gray-800"></h3>
            <button id="closeModalBtn" class="p-2 hover:bg-gray-100 rounded-full transition-colors">
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>
        </div>
        <div id="modalFileContent" class="p-6 overflow-y-auto max-h-[calc(90vh-120px)]"></div>
    </div>
</div>

<script>
const dragDropZone = document.getElementById('dragDropZone');
const browseBtn = document.getElementById('browseBtn');
const fileInput = document.getElementById('fileInput');
const reportsList = document.getElementById('reportsList');
const emptyState = document.getElementById('emptyState');
const sensitiveDataCheckbox = document.getElementById('sensitiveData');
const passwordSection = document.getElementById('passwordSection');
const filePasswordInput = document.getElementById('filePassword');
const searchFiles = document.getElementById('searchFiles');
const filterFiles = document.getElementById('filterFiles');

// Modal elements
const passwordModal = document.getElementById('passwordModal');
const passwordInput = document.getElementById('passwordInput');
const submitPassword = document.getElementById('submitPassword');
const cancelPassword = document.getElementById('cancelPassword');
const previewModal = document.getElementById('previewModal');
const modalTitle = document.getElementById('modalTitle');
const modalFileContent = document.getElementById('modalFileContent');
const closeModalBtn = document.getElementById('closeModalBtn');

// Statistics
const totalFilesEl = document.getElementById('totalFiles');
const sensitiveFilesEl = document.getElementById('sensitiveFiles');
const storageUsedEl = document.getElementById('storageUsed');

let uploadedFiles = [];
let currentFileForPassword = null;

// Show/hide password section
sensitiveDataCheckbox.addEventListener('change', (e) => {
    if (e.target.checked) {
        passwordSection.classList.remove('hidden');
        passwordSection.classList.add('animate-slide-up');
    } else {
        passwordSection.classList.add('hidden');
        filePasswordInput.value = '';
    }
});

// Utility functions
function formatBytes(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

function getFileIcon(fileName) {
    const ext = fileName.split('.').pop().toLowerCase();
    const icons = {
        pdf: '📄',
        doc: '📝', docx: '📝',
        xls: '📊', xlsx: '📊',
        txt: '📋',
        png: '🖼️', jpg: '🖼️', jpeg: '🖼️',
        default: '📁'
    };
    return icons[ext] || icons.default;
}

function updateStatistics() {
    const total = uploadedFiles.length;
    const sensitive = uploadedFiles.filter(f => f.isProtected).length;
    const totalSize = uploadedFiles.reduce((sum, f) => sum + f.file.size, 0);
    
    totalFilesEl.textContent = total;
    sensitiveFilesEl.textContent = sensitive;
    storageUsedEl.textContent = formatBytes(totalSize);
    
    emptyState.style.display = total === 0 ? 'block' : 'none';
}

function addFileUI(fileObj) {
    const div = document.createElement('div');
    div.className = 'bg-gradient-to-r from-gray-50 to-white p-4 rounded-xl border border-gray-200 hover:shadow-lg transition-all duration-300 animate-fade-in';
    div.dataset.id = fileObj.id;

    const isProtected = fileObj.isProtected;
    const protectedBadge = isProtected ? 
        '<span class="inline-flex items-center gap-1 px-2 py-1 bg-amber-100 text-amber-800 text-xs font-medium rounded-full"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z"/></svg>Protected</span>' : 
        '<span class="inline-flex items-center gap-1 px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full"><svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/></svg>Public</span>';

    div.innerHTML = `
        <div class="flex items-center justify-between">
            <div class="flex items-center gap-4 flex-1 min-w-0">
                <div class="text-2xl">${getFileIcon(fileObj.file.name)}</div>
                <div class="flex-1 min-w-0">
                    <div class="flex items-center gap-2 mb-1">
                        <h3 class="font-semibold text-gray-800 truncate" title="${fileObj.file.name}">${fileObj.file.name}</h3>
                        ${protectedBadge}
                    </div>
                    <p class="text-sm text-gray-500">${formatBytes(fileObj.file.size)} • Uploaded ${fileObj.uploadDate}</p>
                </div>
            </div>
            <div class="flex items-center gap-2 ml-4">
                <button onclick="viewFile('${fileObj.id}')" class="p-3 bg-blue-500 hover:bg-blue-600 text-white rounded-xl transition-colors" title="View Document">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                        <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z"/>
                    </svg>
                </button>
                <button onclick="downloadFile('${fileObj.id}')" class="p-3 bg-green-500 hover:bg-green-600 text-white rounded-xl transition-colors" title="Download">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"/>
                    </svg>
                </button>
                <button onclick="analyzeFile('${fileObj.id}')" class="p-3 bg-purple-500 hover:bg-purple-600 text-white rounded-xl transition-colors" title="Analyze">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M2 11a1 1 0 011-1h2a1 1 0 011 1v5a1 1 0 01-1 1H3a1 1 0 01-1-1v-5zM8 7a1 1 0 011-1h2a1 1 0 011 1v9a1 1 0 01-1 1H9a1 1 0 01-1-1V7zM14 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1h-2a1 1 0 01-1-1V4z"/>
                    </svg>
                </button>
                <button onclick="deleteFile('${fileObj.id}')" class="p-3 bg-red-500 hover:bg-red-600 text-white rounded-xl transition-colors" title="Delete">
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"/>
                    </svg>
                </button>
            </div>
        </div>
    `;

    reportsList.appendChild(div);
    updateStatistics();
}

function loadFiles(files) {
    const isSensitive = sensitiveDataCheckbox.checked;
    const password = isSensitive ? filePasswordInput.value : null;

    if (isSensitive && !password) {
        alert('Please set a password for sensitive files!');
        return;
    }

    for (const file of files) {
        const id = Date.now() + Math.random();
        const fileObj = {
            id,
            file,
            uploadDate: new Date().toLocaleDateString(),
            isProtected: isSensitive,
            password: password
        };
        uploadedFiles.push(fileObj);
        addFileUI(fileObj);
    }

    // Reset form
    sensitiveDataCheckbox.checked = false;
    passwordSection.classList.add('hidden');
    filePasswordInput.value = '';
}

// Password verification
function verifyPassword(fileId, action) {
    const file = uploadedFiles.find(f => f.id == fileId);
    if (!file.isProtected) {
        action();
        return;
    }

    currentFileForPassword = { fileId, action };
    passwordModal.classList.remove('hidden');
    passwordModal.classList.add('flex');
    passwordInput.focus();
}

submitPassword.addEventListener('click', () => {
    const enteredPassword = passwordInput.value;
    const file = uploadedFiles.find(f => f.id == currentFileForPassword.fileId);
    
    if (enteredPassword === file.password) {
        passwordModal.classList.add('hidden');
        passwordModal.classList.remove('flex');
        passwordInput.value = '';
        currentFileForPassword.action();
    } else {
        passwordInput.classList.add('border-red-500', 'bg-red-50');
        setTimeout(() => {
            passwordInput.classList.remove('border-red-500', 'bg-red-50');
        }, 2000);
    }
});

cancelPassword.addEventListener('click', () => {
    passwordModal.classList.add('hidden');
    passwordModal.classList.remove('flex');
    passwordInput.value = '';
});

// File operations
function viewFile(id) {
    verifyPassword(id, () => {
        const fileObj = uploadedFiles.find(f => f.id == id);
        if (!fileObj) return;

        modalTitle.textContent = fileObj.file.name;
        modalFileContent.innerHTML = '';
        const file = fileObj.file;

        if (file.type.startsWith('image/')) {
            const img = document.createElement('img');
            img.src = URL.createObjectURL(file);
            img.className = 'max-w-full max-h-96 mx-auto rounded-xl shadow-lg';
            modalFileContent.appendChild(img);
        } else if (file.type === 'application/pdf') {
            const iframe = document.createElement('iframe');
            iframe.src = URL.createObjectURL(file);
            iframe.className = 'w-full h-96 rounded-xl border-0';
            modalFileContent.appendChild(iframe);
        } else if (file.type.startsWith('text/')) {
            const reader = new FileReader();
            reader.onload = e => {
                const pre = document.createElement('pre');
                pre.textContent = e.target.result;
                pre.className = 'bg-gray-100 p-4 rounded-xl max-h-96 overflow-y-auto text-sm';
                modalFileContent.appendChild(pre);
            };
            reader.readAsText(file);
        } else {
            modalFileContent.innerHTML = `
                <div class="text-center py-8">
                    <svg class="w-16 h-16 text-gray-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <p class="text-gray-600">Preview not available for this file type</p>
                </div>
            `;
        }
        previewModal.classList.remove('hidden');
        previewModal.classList.add('flex');
    });
}

function downloadFile(id) {
    verifyPassword(id, () => {
        const fileObj = uploadedFiles.find(f => f.id == id);
        if (!fileObj) return;
        
        const url = URL.createObjectURL(fileObj.file);
        const a = document.createElement('a');
        a.href = url;
        a.download = fileObj.file.name;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    });
}

function deleteFile(id) {
    if (confirm('Are you sure you want to delete this document?')) {
        uploadedFiles = uploadedFiles.filter(f => f.id != id);
        const el = reportsList.querySelector(`[data-id="${id}"]`);
        if (el) {
            el.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
            el.style.transform = 'translateX(-100%)';
            el.style.opacity = '0';
            setTimeout(() => {
                el.remove();
                updateStatistics();
            }, 300);
        }
    }
}

function analyzeFile(id) {
    verifyPassword(id, () => {
        const fileObj = uploadedFiles.find(f => f.id == id);
        if (!fileObj) return;
        
        // Show analysis notification
        const notification = document.createElement('div');
        notification.className = 'fixed top-24 right-6 bg-purple-500 text-white px-6 py-4 rounded-xl shadow-lg z-50 transition-all duration-300';
        notification.innerHTML = `
            <div class="flex items-center gap-3">
                <svg class="w-5 h-5 animate-spin" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1z"/>
                </svg>
                <span>Analyzing "${fileObj.file.name}"...</span>
            </div>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.innerHTML = `
                <div class="flex items-center gap-3">
                    <svg class="w-5 h-5 text-green-300" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"/>
                    </svg>
                    <span>Analysis complete!</span>
                </div>
            `;
            setTimeout(() => notification.remove(), 2000);
        }, 3000);
    });
}

// Search and filter functionality
searchFiles.addEventListener('input', (e) => {
    const query = e.target.value.toLowerCase();
    const fileElements = reportsList.querySelectorAll('[data-id]');
    
    fileElements.forEach(el => {
        const fileName = el.querySelector('h3').textContent.toLowerCase();
        if (fileName.includes(query)) {
            el.style.display = 'block';
        } else {
            el.style.display = 'none';
        }
    });
});

filterFiles.addEventListener('change', (e) => {
    const filter = e.target.value;
    const fileElements = reportsList.querySelectorAll('[data-id]');
    
    fileElements.forEach(el => {
        const fileId = el.dataset.id;
        const file = uploadedFiles.find(f => f.id == fileId);
        let show = false;
        
        switch(filter) {
            case 'all':
                show = true;
                break;
            case 'sensitive':
                show = file && file.isProtected;
                break;
            case 'public':
                show = file && !file.isProtected;
                break;
            case 'recent':
                const today = new Date().toLocaleDateString();
                show = file && file.uploadDate === today;
                break;
        }
        
        el.style.display = show ? 'block' : 'none';
    });
});

// Drag & Drop handlers
['dragenter', 'dragover'].forEach(evt => {
    dragDropZone.addEventListener(evt, e => {
        e.preventDefault();
        dragDropZone.classList.add('border-blue-400', 'bg-blue-50');
    });
});

['dragleave', 'drop'].forEach(evt => {
    dragDropZone.addEventListener(evt, e => {
        e.preventDefault();
        dragDropZone.classList.remove('border-blue-400', 'bg-blue-50');
    });
});

dragDropZone.addEventListener('drop', e => {
    const files = e.dataTransfer.files;
    if (files.length) loadFiles(files);
});

dragDropZone.addEventListener('click', () => fileInput.click());
browseBtn.addEventListener('click', () => fileInput.click());

fileInput.addEventListener('change', e => {
    if (e.target.files.length) loadFiles(e.target.files);
    fileInput.value = '';
});

// Close modals
closeModalBtn.addEventListener('click', () => {
    previewModal.classList.add('hidden');
    previewModal.classList.remove('flex');
});

previewModal.addEventListener('click', e => {
    if (e.target === previewModal) {
        previewModal.classList.add('hidden');
        previewModal.classList.remove('flex');
    }
});

// Initialize
updateStatistics();
</script>

</body>
</html>
